{"mappings":"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","sources":["LightMapDemoScene.js"],"sourcesContent":["'use strict';\n\n// Array flattening trick from http://stackoverflow.com/questions/10865025/merge-flatten-a-multidimensional-array-in-javascript\n\nvar LightMapDemoScene = function (gl) {\n\tthis.gl = gl;\n};\n\nLightMapDemoScene.prototype.Load = function (cb) {\n\tconsole.log('Loading demo scene');\n\n\tvar me = this;\n\tconsole.log(me);\n\n\tasync.parallel({\n\t\tModels: function (callback) {\n\t\t\tasync.map({\n\t\t\t\tRoomModel: 'Room.json'\n\t\t\t}, LoadJSONResource, callback);\n\t\t},\n\t\tShaderCode: function (callback) {\n\t\t\tasync.map({\n\t\t\t\t'NoShadow_VSText': 'shaders/NoShadow.vs.glsl',\n\t\t\t\t'NoShadow_FSText': 'shaders/NoShadow.fs.glsl',\n\t\t\t\t'Shadow_VSText': 'shaders/Shadow.vs.glsl',\n\t\t\t\t'Shadow_FSText': 'shaders/Shadow.fs.glsl',\n\t\t\t\t'ShadowMapGen_VSText': 'shaders/ShadowMapGen.vs.glsl',\n\t\t\t\t'ShadowMapGen_FSText': 'shaders/ShadowMapGen.fs.glsl'\n\t\t\t}, LoadTextResource, callback);\n\t\t}\n\t}, function (loadErrors, loadResults) {\n\t\tif (loadErrors) {\n\t\t\tcb(loadErrors);\n\t\t\treturn;\n\t\t}\n\n\t\t//\n\t\t// Create Model objects\n\t\t//\n\t\tfor (var i = 0; i < loadResults.Models.RoomModel.meshes.length; i++) {\n\t\t\tvar mesh = loadResults.Models.RoomModel.meshes[i];\n\t\t\tswitch (mesh.name) {\n\t\t\t\tcase 'MonkeyMesh':\n\t\t\t\t\tme.MonkeyMesh = new Model(\n\t\t\t\t\t\tme.gl,\n\t\t\t\t\t\tmesh.vertices,\n\t\t\t\t\t\t[].concat.apply([], mesh.faces),\n\t\t\t\t\t\tmesh.normals,\n\t\t\t\t\t\tvec4.fromValues(0.8, 0.8, 1.0, 1.0)\n\t\t\t\t\t);\n\t\t\t\t\tmat4.rotate(\n\t\t\t\t\t\tme.MonkeyMesh.world, me.MonkeyMesh.world,\n\t\t\t\t\t\tglMatrix.toRadian(94.87),\n\t\t\t\t\t\tvec3.fromValues(0, 0, -1)\n\t\t\t\t\t);\n\t\t\t\t\tmat4.translate(\n\t\t\t\t\t\tme.MonkeyMesh.world, me.MonkeyMesh.world,\n\t\t\t\t\t\tvec4.fromValues(2.07919, -0.98559, 1.75740)\n\t\t\t\t\t);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'TableMesh':\n\t\t\t\t\tme.TableMesh = new Model(\n\t\t\t\t\t\tme.gl, mesh.vertices, [].concat.apply([], mesh.faces),\n\t\t\t\t\t\tmesh.normals, vec4.fromValues(1, 0, 1, 1)\n\t\t\t\t\t);\n\t\t\t\t\tmat4.translate(\n\t\t\t\t\t\tme.TableMesh.world, me.TableMesh.world,\n\t\t\t\t\t\tvec3.fromValues(1.57116, -0.79374, 0.49672)\n\t\t\t\t\t);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'SofaMesh':\n\t\t\t\t\tme.SofaMesh = new Model(\n\t\t\t\t\t\tme.gl, mesh.vertices, [].concat.apply([], mesh.faces),\n\t\t\t\t\t\tmesh.normals, vec4.fromValues(0, 1, 1, 1)\t\n\t\t\t\t\t);\n\t\t\t\t\tmat4.translate(\n\t\t\t\t\t\tme.SofaMesh.world, me.SofaMesh.world,\n\t\t\t\t\t\tvec3.fromValues(-3.28768, 0, 0.78448)\n\t\t\t\t\t);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'LightBulbMesh':\n\t\t\t\t\tme.lightPosition = vec3.fromValues(0, 0.0, 2.58971);\n\t\t\t\t\tme.LightMesh = new Model(\n\t\t\t\t\t\tme.gl, mesh.vertices, [].concat.apply([], mesh.faces),\n\t\t\t\t\t\tmesh.normals, vec4.fromValues(4, 4, 4, 1)\n\t\t\t\t\t);\n\t\t\t\t\tmat4.translate(me.LightMesh.world, me.LightMesh.world,\n\t\t\t\t\t\tme.lightPosition\n\t\t\t\t\t);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'WallsMesh':\n\t\t\t\t\tme.WallsMesh = new Model(\n\t\t\t\t\t\tme.gl, mesh.vertices, [].concat.apply([], mesh.faces),\n\t\t\t\t\t\tmesh.normals, vec4.fromValues(0.3, 0.3, 0.3, 1)\n\t\t\t\t\t);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (!me.MonkeyMesh) {\n\t\t\tcb('Failed to load monkey mesh'); return;\n\t\t}\n\t\tif (!me.TableMesh) {\n\t\t\tcb('Failed to load table mesh'); return;\n\t\t}\n\t\tif (!me.SofaMesh) {\n\t\t\tcb('Failed to load sofa mesh'); return;\n\t\t}\n\t\tif (!me.LightMesh) {\n\t\t\tcb('Failed to load light mesh'); return;\n\t\t}\n\t\tif (!me.WallsMesh) {\n\t\t\tcb('Failed to load walls mesh'); return;\n\t\t}\n\t\tme.Meshes = [\n\t\t\tme.MonkeyMesh,\n\t\t\tme.TableMesh,\n\t\t\tme.SofaMesh,\n\t\t\tme.LightMesh,\n\t\t\tme.WallsMesh\n\t\t];\n\n\t\t//\n\t\t// Create Shaders\n\t\t//\n\t\tme.NoShadowProgram = CreateShaderProgram(\n\t\t\tme.gl, loadResults.ShaderCode.NoShadow_VSText,\n\t\t\tloadResults.ShaderCode.NoShadow_FSText\n\t\t);\n\t\tif (me.NoShadowProgram.error) {\n\t\t\tcb('NoShadowProgram ' + me.NoShadowProgram.error); return;\n\t\t}\n\n\t\tme.ShadowProgram = CreateShaderProgram(\n\t\t\tme.gl, loadResults.ShaderCode.Shadow_VSText,\n\t\t\tloadResults.ShaderCode.Shadow_FSText\n\t\t);\n\t\tif (me.ShadowProgram.error) {\n\t\t\tcb('ShadowProgram ' + me.ShadowProgram.error); return;\n\t\t}\n\n\t\tme.ShadowMapGenProgram = CreateShaderProgram(\n\t\t\tme.gl, loadResults.ShaderCode.ShadowMapGen_VSText,\n\t\t\tloadResults.ShaderCode.ShadowMapGen_FSText\n\t\t);\n\t\tif (me.ShadowMapGenProgram.error) {\n\t\t\tcb('ShadowMapGenProgram ' + me.ShadowMapGenProgram.error); return;\n\t\t}\n\n\t\tme.NoShadowProgram.uniforms = {\n\t\t\tmProj: me.gl.getUniformLocation(me.NoShadowProgram, 'mProj'),\n\t\t\tmView: me.gl.getUniformLocation(me.NoShadowProgram, 'mView'),\n\t\t\tmWorld: me.gl.getUniformLocation(me.NoShadowProgram, 'mWorld'),\n\n\t\t\tpointLightPosition: me.gl.getUniformLocation(me.NoShadowProgram, 'pointLightPosition'),\n\t\t\tmeshColor: me.gl.getUniformLocation(me.NoShadowProgram, 'meshColor'),\n\t\t};\n\t\tme.NoShadowProgram.attribs = {\n\t\t\tvPos: me.gl.getAttribLocation(me.NoShadowProgram, 'vPos'),\n\t\t\tvNorm: me.gl.getAttribLocation(me.NoShadowProgram, 'vNorm'),\n\t\t};\n\n\t\tme.ShadowProgram.uniforms = {\n\t\t\tmProj: me.gl.getUniformLocation(me.ShadowProgram, 'mProj'),\n\t\t\tmView: me.gl.getUniformLocation(me.ShadowProgram, 'mView'),\n\t\t\tmWorld: me.gl.getUniformLocation(me.ShadowProgram, 'mWorld'),\n\n\t\t\tpointLightPosition: me.gl.getUniformLocation(me.ShadowProgram, 'pointLightPosition'),\n\t\t\tmeshColor: me.gl.getUniformLocation(me.ShadowProgram, 'meshColor'),\n\t\t\tlightShadowMap: me.gl.getUniformLocation(me.ShadowProgram, 'lightShadowMap'),\n\t\t\tshadowClipNearFar: me.gl.getUniformLocation(me.ShadowProgram, 'shadowClipNearFar'),\n\n\t\t\tbias: me.gl.getUniformLocation(me.ShadowProgram, 'bias')\n\t\t};\n\t\tme.ShadowProgram.attribs = {\n\t\t\tvPos: me.gl.getAttribLocation(me.ShadowProgram, 'vPos'),\n\t\t\tvNorm: me.gl.getAttribLocation(me.ShadowProgram, 'vNorm'),\n\t\t};\n\n\t\tme.ShadowMapGenProgram.uniforms = {\n\t\t\tmProj: me.gl.getUniformLocation(me.ShadowMapGenProgram, 'mProj'),\n\t\t\tmView: me.gl.getUniformLocation(me.ShadowMapGenProgram, 'mView'),\n\t\t\tmWorld: me.gl.getUniformLocation(me.ShadowMapGenProgram, 'mWorld'),\n\n\t\t\tpointLightPosition: me.gl.getUniformLocation(me.ShadowMapGenProgram, 'pointLightPosition'),\n\t\t\tshadowClipNearFar: me.gl.getUniformLocation(me.ShadowMapGenProgram, 'shadowClipNearFar'),\n\t\t};\n\t\tme.ShadowMapGenProgram.attribs = {\n\t\t\tvPos: me.gl.getAttribLocation(me.ShadowMapGenProgram, 'vPos'),\n\t\t};\n\n\t\t//\n\t\t// Create Framebuffers and Textures\n\t\t//\n\t\tme.shadowMapCube = me.gl.createTexture();\n\t\tme.gl.bindTexture(me.gl.TEXTURE_CUBE_MAP, me.shadowMapCube);\n\t\tme.gl.texParameteri(me.gl.TEXTURE_CUBE_MAP, me.gl.TEXTURE_MIN_FILTER, me.gl.LINEAR);\n\t\tme.gl.texParameteri(me.gl.TEXTURE_CUBE_MAP, me.gl.TEXTURE_MAG_FILTER, me.gl.LINEAR);\n\t\tme.gl.texParameteri(me.gl.TEXTURE_CUBE_MAP, me.gl.TEXTURE_WRAP_S, me.gl.MIRRORED_REPEAT);\n\t\tme.gl.texParameteri(me.gl.TEXTURE_CUBE_MAP, me.gl.TEXTURE_WRAP_T, me.gl.MIRRORED_REPEAT);\n\t\tme.floatExtension = me.gl.getExtension(\"OES_texture_float\");\n\t\tme.floatLinearExtension = me.gl.getExtension(\"OES_texture_float_linear\");\n\t\tif (me.floatExtension && me.floatLinearExtension) {\n\t\t\tfor (var i = 0; i < 6; i++) {\n\t\t\t\tme.gl.texImage2D(\n\t\t\t\t\tme.gl.TEXTURE_CUBE_MAP_POSITIVE_X + i,\n\t\t\t\t\t0, me.gl.RGBA,\n\t\t\t\t\tme.textureSize, me.textureSize,\n\t\t\t\t\t0, me.gl.RGBA,\n\t\t\t\t\tme.gl.FLOAT, null\n\t\t\t\t);\n\t\t\t}\n\t\t} else {\n\t\t\tfor (var i = 0; i < 6; i++) {\n\t\t\t\tme.gl.texImage2D(\n\t\t\t\t\tme.gl.TEXTURE_CUBE_MAP_POSITIVE_X + i,\n\t\t\t\t\t0, me.gl.RGBA,\n\t\t\t\t\tme.textureSize, me.textureSize,\n\t\t\t\t\t0, me.gl.RGBA,\n\t\t\t\t\tme.gl.UNSIGNED_BYTE, null\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tme.shadowMapFramebuffer = me.gl.createFramebuffer();\n\t\tme.gl.bindFramebuffer(me.gl.FRAMEBUFFER, me.shadowMapFramebuffer);\n\n\t\tme.shadowMapRenderbuffer = me.gl.createRenderbuffer();\n\t\tme.gl.bindRenderbuffer(me.gl.RENDERBUFFER, me.shadowMapRenderbuffer);\n\t\tme.gl.renderbufferStorage(\n\t\t\tme.gl.RENDERBUFFER, me.gl.DEPTH_COMPONENT16,\n\t\t\tme.textureSize, me.textureSize\n\t\t);\n\n\t\tme.gl.bindTexture(me.gl.TEXTURE_CUBE_MAP, null);\n\t\tme.gl.bindRenderbuffer(me.gl.RENDERBUFFER, null);\n\t\tme.gl.bindFramebuffer(me.gl.FRAMEBUFFER, null);\n\n\t\t//\n\t\t// Logical Values\n\t\t//\n\t\tme.camera = new Camera(\n\t\t\tvec3.fromValues(0, 0, 1.85),\n\t\t\tvec3.fromValues(-0.3, -1, 1.85),\n\t\t\tvec3.fromValues(0, 0, 1)\n\t\t);\n\n\t\tme.projMatrix = mat4.create();\n\t\tme.viewMatrix = mat4.create();\n\n\t\tmat4.perspective(\n\t\t\tme.projMatrix,\n\t\t\tglMatrix.toRadian(90),\n\t\t\tme.gl.canvas.clientWidth / me.gl.canvas.clientHeight,\n\t\t\t0.35,\n\t\t\t85.0\n\t\t);\n\n\t\tme.shadowMapCameras = [\n\t\t\t// Positive X\n\t\t\tnew Camera(\n\t\t\t\tme.lightPosition,\n\t\t\t\tvec3.add(vec3.create(), me.lightPosition, vec3.fromValues(1, 0, 0)),\n\t\t\t\tvec3.fromValues(0, -1, 0)\n\t\t\t),\n\t\t\t// Negative X\n\t\t\tnew Camera(\n\t\t\t\tme.lightPosition,\n\t\t\t\tvec3.add(vec3.create(), me.lightPosition, vec3.fromValues(-1, 0, 0)),\n\t\t\t\tvec3.fromValues(0, -1, 0)\n\t\t\t),\n\t\t\t// Positive Y\n\t\t\tnew Camera(\n\t\t\t\tme.lightPosition,\n\t\t\t\tvec3.add(vec3.create(), me.lightPosition, vec3.fromValues(0, 1, 0)),\n\t\t\t\tvec3.fromValues(0, 0, 1)\n\t\t\t),\n\t\t\t// Negative Y\n\t\t\tnew Camera(\n\t\t\t\tme.lightPosition,\n\t\t\t\tvec3.add(vec3.create(), me.lightPosition, vec3.fromValues(0, -1, 0)),\n\t\t\t\tvec3.fromValues(0, 0, -1)\n\t\t\t),\n\t\t\t// Positive Z\n\t\t\tnew Camera(\n\t\t\t\tme.lightPosition,\n\t\t\t\tvec3.add(vec3.create(), me.lightPosition, vec3.fromValues(0, 0, 1)),\n\t\t\t\tvec3.fromValues(0, -1, 0)\n\t\t\t),\n\t\t\t// Negative Z\n\t\t\tnew Camera(\n\t\t\t\tme.lightPosition,\n\t\t\t\tvec3.add(vec3.create(), me.lightPosition, vec3.fromValues(0, 0, -1)),\n\t\t\t\tvec3.fromValues(0, -1, 0)\n\t\t\t),\n\t\t];\n\t\tme.shadowMapViewMatrices = [\n\t\t\tmat4.create(),\n\t\t\tmat4.create(),\n\t\t\tmat4.create(),\n\t\t\tmat4.create(),\n\t\t\tmat4.create(),\n\t\t\tmat4.create()\n\t\t];\n\t\tme.shadowMapProj = mat4.create();\n\t\tme.shadowClipNearFar = vec2.fromValues(0.05, 15.0);\n\t\tmat4.perspective(\n\t\t\tme.shadowMapProj,\n\t\t\tglMatrix.toRadian(90),\n\t\t\t1.0,\n\t\t\tme.shadowClipNearFar[0],\n\t\t\tme.shadowClipNearFar[1]\n\t\t);\n\n\t\tcb();\n\t});\n\n\tme.PressedKeys = {\n\t\tUp: false,\n\t\tRight: false,\n\t\tDown: false,\n\t\tLeft: false,\n\t\tForward: false,\n\t\tBack: false,\n\n\t\tRotLeft: false,\n\t\tRotRight: false,\n\t};\n\n\tme.MoveForwardSpeed = 3.5;\n\tme.RotateSpeed = 1.5;\n\tme.textureSize = getParameterByName('texSize') || 512;\n\n\tme.lightDisplacementInputAngle = 0.0;\n};\n\nLightMapDemoScene.prototype.Unload = function () {\n\tthis.LightMesh = null;\n\tthis.MonkeyMesh = null;\n\tthis.TableMesh = null;\n\tthis.SofaMesh = null;\n\tthis.WallsMesh = null;\n\n\tthis.NoShadowProgram = null;\n\tthis.ShadowProgram = null;\n\tthis.ShadowMapGenProgram = null;\n\n\tthis.camera = null;\n\tthis.lightPosition = null;\n\n\tthis.Meshes = null;\n\n\tthis.PressedKeys = null;\n\n\tthis.MoveForwardSpeed = null;\n\tthis.RotateSpeed = null;\n\n\tthis.shadowMapCube = null;\n\tthis.textureSize = null;\n\n\tthis.shadowMapCameras = null;\n\tthis.shadowMapViewMatrices = null;\n};\n\nLightMapDemoScene.prototype.Begin = function () {\n\tconsole.log('Beginning demo scene');\n\n\tvar me = this;\n\tconsole.log(\"keys\", me);\n\n\t// Attach event listeners\n\tthis.__ResizeWindowListener = this._OnResizeWindow.bind(this);\n\tthis.__KeyDownWindowListener = this._OnKeyDown.bind(this);\n\tthis.__KeyUpWindowListener = this._OnKeyUp.bind(this);\n\n\tAddEvent(window, 'resize', this.__ResizeWindowListener);\n\tAddEvent(window, 'keydown', this.__KeyDownWindowListener);\n\tAddEvent(window, 'keyup', this.__KeyUpWindowListener);\n\t\n\t// Render Loop\n\tvar previousFrame = performance.now();\n\tvar dt = 0;\n\tvar loop = function (currentFrameTime) {\n\t\tdt = currentFrameTime - previousFrame;\n\t\tme._Update(dt);\n\t\tpreviousFrame = currentFrameTime;\n\n\t\tme._GenerateShadowMap();\n\t\tme._Render();\n\t\tme.nextFrameHandle = requestAnimationFrame(loop);\n\t};\n\tme.nextFrameHandle = requestAnimationFrame(loop);\n\n\tme._OnResizeWindow();\n};\n\nLightMapDemoScene.prototype.End = function () {\n\tif (this.__ResizeWindowListener) {\n\t\tRemoveEvent(window, 'resize', this.__ResizeWindowListener);\n\t}\n\tif (this.__KeyUpWindowListener) {\n\t\tRemoveEvent(window, 'keyup', this.__KeyUpWindowListener);\n\t}\n\tif (this.__KeyDownWindowListener) {\n\t\tRemoveEvent(window, 'keydown', this.__KeyDownWindowListener);\n\t}\n\n\tif (this.nextFrameHandle) {\n\t\tcancelAnimationFrame(this.nextFrameHandle);\n\t}\n};\n\n//\n// Private Methods\n//\nLightMapDemoScene.prototype._Update = function (dt) {\n\tmat4.rotateZ(\n\t\tthis.MonkeyMesh.world, this.MonkeyMesh.world,\n\t\tdt / 1000 * 2 * Math.PI *    0.3\n\t);\n\n\tif (this.PressedKeys.Forward && !this.PressedKeys.Back) {\n\t\tthis.camera.moveForward(dt / 1000 * this.MoveForwardSpeed);\n\t}\n\n\tif (this.PressedKeys.Back && !this.PressedKeys.Forward) {\n\t\tthis.camera.moveForward(-dt / 1000 * this.MoveForwardSpeed);\n\t}\n\n\tif (this.PressedKeys.Right && !this.PressedKeys.Left) {\n\t\tthis.camera.moveRight(dt / 1000 * this.MoveForwardSpeed);\n\t}\n\n\tif (this.PressedKeys.Left && !this.PressedKeys.Right) {\n\t\tthis.camera.moveRight(-dt / 1000 * this.MoveForwardSpeed);\n\t}\n\n\tif (this.PressedKeys.Up && !this.PressedKeys.Down) {\n\t\tthis.camera.moveUp(dt / 1000 * this.MoveForwardSpeed);\n\t}\n\n\tif (this.PressedKeys.Down && !this.PressedKeys.Up) {\n\t\tthis.camera.moveUp(-dt / 1000 * this.MoveForwardSpeed);\n\t}\n\n\tif (this.PressedKeys.RotRight && !this.PressedKeys.RotLeft) {\n\t\tthis.camera.rotateRight(-dt / 1000 * this.RotateSpeed);\n\t}\n\n\tif (this.PressedKeys.RotLeft && !this.PressedKeys.RotRight) {\n\t\tthis.camera.rotateRight(dt / 1000 * this.RotateSpeed);\n\t}\n\n\tthis.lightDisplacementInputAngle += dt / 2337;\n\tvar xDisplacement = Math.sin(this.lightDisplacementInputAngle) * 2.8;\n\n\tthis.LightMesh.world[12] = xDisplacement;\n\tfor (var i = 0; i < this.shadowMapCameras.length; i++) {\n\t\tmat4.getTranslation(this.shadowMapCameras[i].position, this.LightMesh.world);\n\t\tthis.shadowMapCameras[i].GetViewMatrix(this.shadowMapViewMatrices[i]);\n\t}\n\n\tthis.camera.GetViewMatrix(this.viewMatrix);\n};\n\nLightMapDemoScene.prototype._GenerateShadowMap = function () {\n\tvar gl = this.gl;\n\n\t// Set GL state status\n\tgl.useProgram(this.ShadowMapGenProgram);\n\tgl.bindTexture(gl.TEXTURE_CUBE_MAP, this.shadowMapCube);\n\tgl.bindFramebuffer(gl.FRAMEBUFFER, this.shadowMapFramebuffer);\n\tgl.bindRenderbuffer(gl.RENDERBUFFER, this.shadowMapRenderbuffer);\n\n\tgl.viewport(0, 0, this.textureSize, this.textureSize);\n\tgl.enable(gl.DEPTH_TEST);\n\tgl.enable(gl.CULL_FACE);\n\n\t// Set per-frame uniforms\n\tgl.uniform2fv(\n\t\tthis.ShadowMapGenProgram.uniforms.shadowClipNearFar,\n\t\tthis.shadowClipNearFar\n\t);\n\tgl.uniform3fv(\n\t\tthis.ShadowMapGenProgram.uniforms.pointLightPosition,\n\t\tthis.lightPosition\n\t);\n\tgl.uniformMatrix4fv(\n\t\tthis.ShadowMapGenProgram.uniforms.mProj,\n\t\tgl.FALSE,\n\t\tthis.shadowMapProj\n\t);\n\n\tfor (var i = 0; i < this.shadowMapCameras.length; i++) {\n\t\t// Set per light uniforms\n\t\tgl.uniformMatrix4fv(\n\t\t\tthis.ShadowMapGenProgram.uniforms.mView,\n\t\t\tgl.FALSE,\n\t\t\tthis.shadowMapCameras[i].GetViewMatrix(this.shadowMapViewMatrices[i])\n\t\t);\n\n\t\t// Set framebuffer destination\n\t\tgl.framebufferTexture2D(\n\t\t\tgl.FRAMEBUFFER,\n\t\t\tgl.COLOR_ATTACHMENT0,\n\t\t\tgl.TEXTURE_CUBE_MAP_POSITIVE_X + i,\n\t\t\tthis.shadowMapCube,\n\t\t\t0\n\t\t);\n\t\tgl.framebufferRenderbuffer(\n\t\t\tgl.FRAMEBUFFER,\n\t\t\tgl.DEPTH_ATTACHMENT,\n\t\t\tgl.RENDERBUFFER,\n\t\t\tthis.shadowMapRenderbuffer\n\t\t);\n\n\t\tgl.clearColor(0, 0, 0, 1);\n\t\tgl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n\n\t\t// Draw meshes\n\t\tfor (var j = 0; j < this.Meshes.length; j++) {\n\t\t\t// Per object uniforms\n\t\t\tgl.uniformMatrix4fv(\n\t\t\t\tthis.ShadowMapGenProgram.uniforms.mWorld,\n\t\t\t\tgl.FALSE,\n\t\t\t\tthis.Meshes[j].world\n\t\t\t);\n\n\t\t\t// Set attributes\n\t\t\tgl.bindBuffer(gl.ARRAY_BUFFER, this.Meshes[j].vbo);\n\t\t\tgl.vertexAttribPointer(\n\t\t\t\tthis.ShadowMapGenProgram.attribs.vPos,\n\t\t\t\t3, gl.FLOAT, gl.FALSE,\n\t\t\t\t0, 0\n\t\t\t);\n\t\t\tgl.enableVertexAttribArray(this.ShadowMapGenProgram.attribs.vPos);\n\n\t\t\tgl.bindBuffer(gl.ARRAY_BUFFER, null);\n\n\t\t\tgl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.Meshes[j].ibo);\n\t\t\tgl.drawElements(gl.TRIANGLES, this.Meshes[j].nPoints, gl.UNSIGNED_SHORT, 0);\n\t\t\tgl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);\n\t\t}\n\t}\n\n\tgl.bindFramebuffer(gl.FRAMEBUFFER, null);\n\tgl.bindRenderbuffer(gl.RENDERBUFFER, null);\n\tgl.bindTexture(gl.TEXTURE_CUBE_MAP, null);\n};\n\nLightMapDemoScene.prototype._Render = function () {\n\tvar gl = this.gl;\n\n\t// Clear back buffer, set per-frame uniforms\n\tgl.enable(gl.CULL_FACE);\n\tgl.enable(gl.DEPTH_TEST);\n\n\tgl.viewport(0, 0, gl.canvas.clientWidth, gl.canvas.clientHeight);\n\n\tgl.clearColor(0, 0, 0, 1);\n\tgl.clear(gl.DEPTH_BUFFER_BIT | gl.COLOR_BUFFER_BIT);\n\n\tgl.useProgram(this.ShadowProgram);\n\tgl.uniformMatrix4fv(this.ShadowProgram.uniforms.mProj, gl.FALSE, this.projMatrix);\n\tgl.uniformMatrix4fv(this.ShadowProgram.uniforms.mView, gl.FALSE, this.viewMatrix);\n\tgl.uniform3fv(this.ShadowProgram.uniforms.pointLightPosition, this.lightPosition);\n\tgl.uniform2fv(this.ShadowProgram.uniforms.shadowClipNearFar, this.shadowClipNearFar);\n\tif (this.floatExtension && this.floatLinearExtension) {\n\t\tgl.uniform1f(this.ShadowProgram.uniforms.bias, 0.0001);\n\t} else {\n\t\tgl.uniform1f(this.ShadowProgram.uniforms.bias, 0.003);\n\t}\n\tgl.uniform1i(this.ShadowProgram.uniforms.lightShadowMap, 0);\n\tgl.activeTexture(gl.TEXTURE0);\n\tgl.bindTexture(gl.TEXTURE_CUBE_MAP, this.shadowMapCube);\n\n\t// Draw meshes\n\tfor (var i = 0; i < this.Meshes.length; i++) {\n\t\t// Per object uniforms\n\t\tgl.uniformMatrix4fv(\n\t\t\tthis.ShadowProgram.uniforms.mWorld,\n\t\t\tgl.FALSE,\n\t\t\tthis.Meshes[i].world\n\t\t);\n\t\tgl.uniform4fv(\n\t\t\tthis.ShadowProgram.uniforms.meshColor,\n\t\t\tthis.Meshes[i].color\n\t\t);\n\n\t\t// Set attributes\n\t\tgl.bindBuffer(gl.ARRAY_BUFFER, this.Meshes[i].vbo);\n\t\tgl.vertexAttribPointer(\n\t\t\tthis.ShadowProgram.attribs.vPos,\n\t\t\t3, gl.FLOAT, gl.FALSE,\n\t\t\t0, 0\n\t\t);\n\t\tgl.enableVertexAttribArray(this.ShadowProgram.attribs.vPos);\n\n\t\tgl.bindBuffer(gl.ARRAY_BUFFER, this.Meshes[i].nbo);\n\t\tgl.vertexAttribPointer(\n\t\t\tthis.ShadowProgram.attribs.vNorm,\n\t\t\t3, gl.FLOAT, gl.FALSE,\n\t\t\t0, 0\n\t\t);\n\t\tgl.enableVertexAttribArray(this.ShadowProgram.attribs.vNorm);\t\t\n\n\t\tgl.bindBuffer(gl.ARRAY_BUFFER, null);\n\n\t\tgl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.Meshes[i].ibo);\n\t\tgl.drawElements(gl.TRIANGLES, this.Meshes[i].nPoints, gl.UNSIGNED_SHORT, 0);\n\t\tgl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);\n\t}\n};\n\n//\n// Event Listeners\n//\nLightMapDemoScene.prototype._OnResizeWindow = function () {\n\tvar gl = this.gl;\n\n\tvar targetHeight = window.innerWidth * 9 / 16;\n\n\tif (window.innerHeight > targetHeight) {\n\t\t// Center vertically\n\t\tgl.canvas.width = window.innerWidth;\n\t\tgl.canvas.height = targetHeight;\n\t\tgl.canvas.style.left = '0px';\n\t\tgl.canvas.style.top = (window.innerHeight - targetHeight) / 2 + 'px';\n\t} else {\n\t\t// Center horizontally\n\t\tgl.canvas.width = window.innerHeight * 16 / 9;\n\t\tgl.canvas.height = window.innerHeight;\n\t\tgl.canvas.style.left = (window.innerWidth - (gl.canvas.width)) / 2 + 'px';\n\t\tgl.canvas.style.top = '0px';\n\t}\n\n\tgl.viewport(0, 0, gl.drawingBufferWidth, gl.drawingBufferHeight);\n};\n\nLightMapDemoScene.prototype._OnKeyDown = function (e) {\n\tswitch(e.code) {\n\t\tcase 'KeyW':\n\t\t\tthis.PressedKeys.Forward = true;\n\t\t\tbreak;\n\t\tcase 'KeyA':\n\t\t\tthis.PressedKeys.Left = true;\n\t\t\tbreak;\n\t\tcase 'KeyD':\n\t\t\tthis.PressedKeys.Right = true;\n\t\t\tbreak;\n\t\tcase 'KeyS':\n\t\t\tthis.PressedKeys.Back = true;\n\t\t\tbreak;\n\t\tcase 'ArrowUp':\n\t\t\tthis.PressedKeys.Up = true;\n\t\t\tbreak;\n\t\tcase 'ArrowDown':\n\t\t\tthis.PressedKeys.Down = true;\n\t\t\tbreak;\n\t\tcase 'ArrowRight':\n\t\t\tthis.PressedKeys.RotRight = true;\n\t\t\tbreak;\n\t\tcase 'ArrowLeft':\n\t\t\tthis.PressedKeys.RotLeft = true;\n\t\t\tbreak;\n\t}\n};\n\nLightMapDemoScene.prototype._OnKeyUp = function (e) {\n\tswitch(e.code) {\n\t\tcase 'KeyW':\n\t\t\tthis.PressedKeys.Forward = false;\n\t\t\tbreak;\n\t\tcase 'KeyA':\n\t\t\tthis.PressedKeys.Left = false;\n\t\t\tbreak;\n\t\tcase 'KeyD':\n\t\t\tthis.PressedKeys.Right = false;\n\t\t\tbreak;\n\t\tcase 'KeyS':\n\t\t\tthis.PressedKeys.Back = false;\n\t\t\tbreak;\n\t\tcase 'ArrowUp':\n\t\t\tthis.PressedKeys.Up = false;\n\t\t\tbreak;\n\t\tcase 'ArrowDown':\n\t\t\tthis.PressedKeys.Down = false;\n\t\t\tbreak;\n\t\tcase 'ArrowRight':\n\t\t\tthis.PressedKeys.RotRight = false;\n\t\t\tbreak;\n\t\tcase 'ArrowLeft':\n\t\t\tthis.PressedKeys.RotLeft = false;\n\t\t\tbreak;\n\t}\n};"],"names":["LightMapDemoScene","gl","this","prototype","Load","cb","console","log","me","async","parallel","Models","callback","map","RoomModel","LoadJSONResource","ShaderCode","NoShadow_VSText","NoShadow_FSText","Shadow_VSText","Shadow_FSText","ShadowMapGen_VSText","ShadowMapGen_FSText","LoadTextResource","loadErrors","loadResults","i","meshes","length","mesh","name","MonkeyMesh","Model","vertices","concat","apply","faces","normals","vec4","fromValues","mat4","rotate","world","glMatrix","toRadian","vec3","translate","TableMesh","SofaMesh","lightPosition","LightMesh","WallsMesh","Meshes","NoShadowProgram","CreateShaderProgram","error","ShadowProgram","ShadowMapGenProgram","uniforms","mProj","getUniformLocation","mView","mWorld","pointLightPosition","meshColor","attribs","vPos","getAttribLocation","vNorm","lightShadowMap","shadowClipNearFar","bias","shadowMapCube","createTexture","bindTexture","TEXTURE_CUBE_MAP","texParameteri","TEXTURE_MIN_FILTER","LINEAR","TEXTURE_MAG_FILTER","TEXTURE_WRAP_S","MIRRORED_REPEAT","TEXTURE_WRAP_T","floatExtension","getExtension","floatLinearExtension","texImage2D","TEXTURE_CUBE_MAP_POSITIVE_X","RGBA","textureSize","FLOAT","UNSIGNED_BYTE","shadowMapFramebuffer","createFramebuffer","bindFramebuffer","FRAMEBUFFER","shadowMapRenderbuffer","createRenderbuffer","bindRenderbuffer","RENDERBUFFER","renderbufferStorage","DEPTH_COMPONENT16","camera","Camera","projMatrix","create","viewMatrix","perspective","canvas","clientWidth","clientHeight","shadowMapCameras","add","shadowMapViewMatrices","shadowMapProj","vec2","PressedKeys","Up","Right","Down","Left","Forward","Back","RotLeft","RotRight","MoveForwardSpeed","RotateSpeed","getParameterByName","lightDisplacementInputAngle","Unload","Begin","__ResizeWindowListener","_OnResizeWindow","bind","__KeyDownWindowListener","_OnKeyDown","__KeyUpWindowListener","_OnKeyUp","AddEvent","window","previousFrame","performance","now","dt","loop","currentFrameTime","_Update","_GenerateShadowMap","_Render","nextFrameHandle","requestAnimationFrame","End","RemoveEvent","cancelAnimationFrame","rotateZ","Math","PI","moveForward","moveRight","moveUp","rotateRight","xDisplacement","sin","getTranslation","position","GetViewMatrix","useProgram","viewport","enable","DEPTH_TEST","CULL_FACE","uniform2fv","uniform3fv","uniformMatrix4fv","FALSE","framebufferTexture2D","COLOR_ATTACHMENT0","framebufferRenderbuffer","DEPTH_ATTACHMENT","clearColor","clear","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","j","bindBuffer","ARRAY_BUFFER","vbo","vertexAttribPointer","enableVertexAttribArray","ELEMENT_ARRAY_BUFFER","ibo","drawElements","TRIANGLES","nPoints","UNSIGNED_SHORT","uniform1f","uniform1i","activeTexture","TEXTURE0","uniform4fv","color","nbo","targetHeight","innerWidth","innerHeight","width","height","style","left","top","drawingBufferWidth","drawingBufferHeight","e","code"],"version":3,"file":"index.1748e09f.js.map"}